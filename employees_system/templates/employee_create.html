{% extends 'base.html' %}

{% block title %}
    {% if employee %}Edit Employee{% else %}Create Employee{% endif %}
{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">
    {{ form_heading|default:"Employee Information Form" }}
</h1>

<form method="POST" class="space-y-4" id="employeeForm" action="{% url 'employee_create' %}{% if employee %}{% url 'employee_edit' pk=employee.pk %}{% endif %}">
    {% csrf_token %}

    <!-- Standard EmployeeForm fields -->
    <div class="form-group">
        {{ form.first_name.label_tag }} {{ form.first_name }}
        {% if form.first_name.errors %}
            <p class="text-red-500 text-sm">{{ form.first_name.errors }}</p>
        {% endif %}
    </div>
    <div class="form-group">
        {{ form.last_name.label_tag }} {{ form.last_name }}
        {% if form.last_name.errors %}
            <p class="text-red-500 text-sm">{{ form.last_name.errors }}</p>
        {% endif %}
    </div>
    <div class="form-group">
        {{ form.email.label_tag }} {{ form.email }}
        {% if form.email.errors %}
            <p class="text-red-500 text-sm">{{ form.email.errors }}</p>
        {% endif %}
    </div>
    <div class="form-group">
        {{ form.phone.label_tag }} {{ form.phone }}
        {% if form.phone.errors %}
            <p class="text-red-500 text-sm">{{ form.phone.errors }}</p>
        {% endif %}
    </div>
    <div class="form-group">
        {{ form.address.label_tag }} {{ form.address }}
        {% if form.address.errors %}
            <p class="text-red-500 text-sm">{{ form.address.errors }}</p>
        {% endif %}
    </div>
    <div class="form-group">
        {{ form.role.label_tag }} {{ form.role }}
        {% if form.role.errors %}
            <p class="text-red-500 text-sm">{{ form.role.errors }}</p>
        {% endif %}
    </div>
    <div class="form-group">
        {{ form.designation.label_tag }} {{ form.designation }}
        {% if form.designation.errors %}
            <p class="text-red-500 text-sm">{{ form.designation.errors }}</p>
        {% endif %}
    </div>
    <div class="form-group">
        {{ form.reporting_manager.label_tag }} {{ form.reporting_manager }}
        {% if form.reporting_manager.errors %}
            <p class="text-red-500 text-sm">{{ form.reporting_manager.errors }}</p>
        {% endif %}
    </div>

    <button type="submit" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
        {% if employee %}Update{% else %}Create{% endif %}
    </button>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('employeeForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    try {
        const response = await fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });
        const data = await response.json();
        if (data.success) {
            window.location.href = '{% url "employee_list" %}';
        } else {
            alert('Error: ' + JSON.stringify(data.errors));
        }
    } catch (error) {
        alert('An error occurred: ' + error.message);
    }
});
</script>
{% endblock %}