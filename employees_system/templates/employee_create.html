<!DOCTYPE html>
<html>
<head>
    <title>Employee Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="min-h-screen bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">
            {% if employee %}Edit Employee{% else %}Create Employee{% endif %}
        </h1>
        <form method="POST" class="space-y-4" id="employeeForm">
            {% csrf_token %}
            {{ form.as_p }}

            {% for field in fields %}
            <div class="flex flex-col">
                <label class="mb-1" for="{{ field.label }}">{{ field.label }}{% if field.is_required %}*{% endif %}</label>
                {% if field.field_type == 'select' %}
                    <select name="{{ field.label }}" id="{{ field.label }}"
                        class="border rounded p-2" {% if field.is_required %}required{% endif %}>
                        {% for option in field.options %}
                            <option value="{{ option }}"
                                {% if data[field.label] == option %}selected{% endif %}>
                                {{ option }}
                            </option>
                        {% endfor %}
                    </select>
                {% elif field.field_type == 'date' %}
                    <input type="date" name="{{ field.label }}" id="{{ field.label }}"
                        value="{{ data[field.label] }}" class="border rounded p-2"
                        {% if field.is_required %}required{% endif %}>
                {% else %}
                    <input type="{{ field.field_type }}" name="{{ field.label }}" id="{{ field.label }}"
                        value="{{ data[field.label] }}" class="border rounded p-2"
                        {% if field.is_required %}required{% endif %}>
                {% endif %}
            </div>
            {% endfor %}

            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                {% if employee %}Update{% else %}Create{% endif %}
            </button>
        </form>
    </div>

    <script>
    document.getElementById('employeeForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        try {
            const response = await fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            });
            const data = await response.json();
            if (data.success) {
                window.location.href = '{% url 'employee_list' %}';
            } else {
                alert('Error: ' + JSON.stringify(data.errors));
            }
        } catch (error) {
            alert('An error occurred: ' + error.message);
        }
    });
    </script>
</body>
</html>