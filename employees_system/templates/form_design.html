{% extends 'base.html' %}
{% load static %}

{% block title %}
    {{ form_heading|default:"Form Designer" }}
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <h2 class="text-2xl font-bold mb-4">üõ†Ô∏è {{ form_heading|default:"Design Your Form" }}</h2>

    <!-- Field Input Section -->
    <div class="flex gap-4 mb-6">
        <input type="text" id="fieldLabel" placeholder="Field Label" class="border p-2 rounded w-1/3">
        <select id="fieldType" class="border p-2 rounded w-1/4">
            <option value="text">Text</option>
            <option value="email">Email</option>
            <option value="textarea">Textarea</option>
            <option value="number">Number</option>
            <option value="date">Date</option>
            <option value="select">Dropdown</option>
        </select>
        <input type="checkbox" id="fieldRequired" class="mr-2">
        <label for="fieldRequired">Required</label>
        <input type="text" id="fieldOptions" placeholder="Dropdown options (comma-separated)" class="border p-2 rounded w-1/3" style="display: none;">
        <button onclick="addField()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Field</button>
    </div>

    <!-- Field List -->
    <ul id="field-list" class="mb-6"></ul>

    <!-- Save Button -->
    <button onclick="saveFields()" class="bg-green-600 text-white px-4 py-2 rounded mb-8 hover:bg-green-700">üíæ Save Form Design</button>

    <!-- Form Preview -->
    <form id="formPreview" class="space-y-4">
        <!-- Dynamic Fields Only -->
        {% for field in dynamic_fields %}
            <div class="form-group">
                <label class="block font-medium mb-1" for="{{ field.name }}">{{ field.label }}{% if field.required %}*{% endif %}</label>
                {% if field.type == 'select' %}
                    <select name="{{ field.name }}" id="{{ field.name }}" class="border p-2 rounded w-full" {% if field.required %}required{% endif %}>
                        <option value="">Select {{ field.label }}</option>
                        {% for option in field.options %}
                            <option value="{{ option }}">{{ option }}</option>
                        {% endfor %}
                    </select>
                {% elif field.type == 'textarea' %}
                    <textarea name="{{ field.name }}" id="{{ field.name }}" class="border p-2 rounded w-full" {% if field.required %}required{% endif %}></textarea>
                {% elif field.type == 'date' %}
                    <input type="date" name="{{ field.name }}" id="{{ field.name }}"
                           class="border p-2 rounded w-full" {% if field.required %}required{% endif %}>
                {% else %}
                    <input type="{{ field.type }}" name="{{ field.name }}" id="{{ field.name }}"
                           class="border p-2 rounded w-full" {% if field.required %}required{% endif %}>
                {% endif %}
            </div>
        {% endfor %}
    </form>
</div>
{% endblock %}


{% block extra_js %}
<script src="{% static 'js/form_design.js' %}"></script>
<script>
    // Pass dynamic fields and other data to the JavaScript file
    const formDesignerConfig = {
        defaultFields: [
            'first_name',
            'last_name',
            'email',
            'phone',
            'address',
            'role',
            'designation',
            'reporting_manager'
        ],
        fields: [
            {% for field in dynamic_fields %}
                {
                    name: "{{ field.name }}",
                    label: "{{ field.label }}",
                    type: "{{ field.type }}",
                    required: {{ field.required|lower }},
                    options: {{ field.options|safe }}
                },
            {% endfor %}
        ],
        csrfToken: "{{ csrf_token }}",
        formHeading: "{{ form_heading|default:'Custom Employee Form' }}",
        saveUrl: "{% url 'form-design' %}"
    };
</script>
{% endblock %}