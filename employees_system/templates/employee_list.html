{% extends 'base.html' %}

{% block title %}Employees{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">Employees</h1>
<div class="mb-4">
    <a href="{% url 'employee_create' %}" class="submit-btn">Add New Employee</a>
</div>
<form method="GET" class="mb-4 flex space-x-2">
    <input type="text" name="search" value="{{ search|default:'' }}"
           placeholder="Search employees..." class="border rounded p-2 flex-grow">
    <button type="submit" class="submit-btn">Search</button>
</form>
<table>
    <thead>
        <tr class="bg-gray-100">
            <th>Employee ID</th>
            <th>Name</th>
            <th>Role</th>
            <th>Designation</th>
            <th>Reporting Manager</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for employee in employees %}
        <tr>
            <td>{{ employee.emp_id }}</td>
            <td>{{ employee.data.name|default:'N/A' }}</td>
            <td>{{ employee.role }}</td>
            <td>{{ employee.designation }}</td>
            <td>{{ employee.reporting_manager.data.name|default:'None' }}</td>
            <td>
                <a href="{% url 'employee_edit' employee.pk %}" class="text-blue-500">Edit</a>
                <a href="{% url 'employee_detail' employee.pk %}" class="text-blue-500 ml-2">View</a>
                <a href="#" onclick="deleteEmployee({{ employee.pk }})" class="text-red-500 ml-2">Delete</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">No employees found</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block extra_js %}
<script>
async function deleteEmployee(pk) {
    if (confirm('Are you sure you want to delete this employee?')) {
        try {
            const response = await fetch(`/employee/${pk}/delete/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            });
            const data = await response.json();
            if (data.success) {
                window.location.reload();
            } else {
                alert('Error deleting employee');
            }
        } catch (error) {
            alert('An error occurred: ' + error.message);
        }
    }
}
</script>
{% endblock %}